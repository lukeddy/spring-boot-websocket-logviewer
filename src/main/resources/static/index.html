<!DOCTYPE html>
<html>
<head>
    <title>Hello WebSocket</title>
    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script>

        $(function () {
            $('form').submit(function(e){
                e.preventDefault();
            });

            var socket = new SockJS('/gs-guide-websocket');
            var stompClient = Stomp.over(socket);
            stompClient.debug = false;
            var $dir = $("#dir");
            var $fileNames = $("#file-names");
            var $toggleGenerateLog = $('#toggle-generate-log');
            var $appendCustomLog = $('#append-custom-log');
            var $logMessage = $('#log-message');

            $dir.val('c:/temp');

            stompClient.connect({}, function (frame) {
                console.log('Connected: ' + frame);
                stompClient.subscribe('/topic/appendMessage', function (message) {
                    $("#log-area").append("<tr><td>" + message.body + "</td></tr>");
                });
                stompClient.subscribe('/topic/sendFileNames', function (message) {
                    var options = [];
                    var fileNames = JSON.parse(message.body);
                    $.each(fileNames, function () {
                        options.push($('<option></option>').text(this).val(this));
                    });
                    $fileNames.empty();
                    $fileNames.append(options);
                });
                stompClient.subscribe('/topic/appendLog', function (message) {
                    $("#log-area").append(message.body + '\n');
                    $(window).scrollTop($(document).height());
                });
                stompClient.subscribe('/topic/sendInitialDir', function (message) {
                    $dir.val(message.body);
                });

                $dir.change(function(){
                    stompClient.send("/app/dir_change", {}, JSON.stringify({dir: $dir.val()}));
                }).change();

                $fileNames.change(function(){
                    $("#log-area").empty();
                    stompClient.send("/app/filename_change", {}, JSON.stringify({
                        dir: $dir.val(),
                        fileName: $fileNames.val()
                    }));
                });
                $toggleGenerateLog.click(function(){
                    stompClient.send("/app/toggleGenerateLog", {});
                });
                $appendCustomLog.click(function(){
                    stompClient.send("/app/appendCustomLog", {}, JSON.stringify({
                        logMessage: $logMessage.val()
                    }));
                });

            });
        });
    </script>
</head>
<body>
<div>
    <div style="position: fixed;width: 100%;top:0;z-index: 1">
        <div>
            <label for="dir">dir names</label>
            <input id="dir" type="text">
        </div>
        <div>
            <label for="file-names">file names</label>
            <select id="file-names"></select>
        </div>
        <div>
            <button id="toggle-generate-log">toggle-generate-log</button>
        </div>
        <div>
            <label for="log-message">log-message</label>
            <input id="log-message" type="text"/>
            <button id="append-custom-log">append-custom-log</button>
        </div>
        <hr/>
    </div>
    <pre id="log-area" style="margin-top: 120px;"></pre>
</div>
</body>
</html>